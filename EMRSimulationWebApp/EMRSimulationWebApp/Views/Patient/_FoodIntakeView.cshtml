@removeTagHelper Microsoft.AspNetCore.Mvc.TagHelpers.OptionTagHelper, Microsoft.AspNetCore.Mvc.TagHelpers
@removeTagHelper Microsoft.AspNetCore.Mvc.TagHelpers.SelectTagHelper, Microsoft.AspNetCore.Mvc.TagHelpers
@using Microsoft.AspNetCore.Html
@using Microsoft.AspNetCore.Mvc.Rendering
@model EMRSimulation.Domain.Dtos.FoodIntakeDto

@{
    ViewData["Title"] = "Food Intake – View";

    // Helper: find a specific item by meal + label
    EMRSimulation.Domain.Dtos.FoodIntakeItemDto? FindItem(string meal, string label)
        => Model.Items.FirstOrDefault(x => x.Meal == meal && x.Label == label);

    string AmtVal(string? amt) => string.IsNullOrWhiteSpace(amt) ? "0" : amt;

    // --------------------
    // Breakfast items
    // --------------------
    var bfCereal = FindItem("Breakfast", "Cereal with milk");
    var bfToast = FindItem("Breakfast", "Toast");
    var bfHot = FindItem("Breakfast", "Hot breakfast");
    var bfYoghurt = FindItem("Breakfast", "Yoghurt");
    var bfFruit = FindItem("Breakfast", "Fruit");
    var bfBeverage = FindItem("Breakfast", "Beverage");
    var bfOtherFood = FindItem("Breakfast", "Other"); // NEW row

    // Breakfast comment parsing (header level)
    var bc = Model.BreakfastComment ?? "";
    bool cPoor = bc.Contains("poor appetite", StringComparison.OrdinalIgnoreCase);
    bool cNausea = bc.Contains("nausea", StringComparison.OrdinalIgnoreCase);
    bool cRefused = bc.Contains("patient refused meal", StringComparison.OrdinalIgnoreCase);
    bool cInterrupted = bc.Contains("interrupted meal time", StringComparison.OrdinalIgnoreCase);

    string? otherMealTxt = null;
    if (bc.Contains("other meal", StringComparison.OrdinalIgnoreCase))
    {
        var idx = bc.IndexOf("other meal", StringComparison.OrdinalIgnoreCase);
        var seg = bc.Substring(idx);
        var parts = seg.Split(';');
        var piece = parts[0];
        var colon = piece.IndexOf(':');
        if (colon > -1) otherMealTxt = piece.Substring(colon + 1).Trim();
    }

    // --------------------
    // Morning tea items
    // --------------------
    var mtFood = FindItem("Morning tea", "Food");
    var mtBeverage = FindItem("Morning tea", "Beverage");

    // --------------------
    // Lunch items (now shown in View)
    // --------------------
    var lnSoup = FindItem("Lunch", "Soup");
    var lnBread = FindItem("Lunch", "Bread / Bread rolls");
    var lnMain = FindItem("Lunch", "Main meal");
    var lnCarb = FindItem("Lunch", "Potato/rice/pasta");
    var lnSalad = FindItem("Lunch", "Salad/vegetables");
    var lnSandwich = FindItem("Lunch", "Sandwiches");
    var lnDessert = FindItem("Lunch", "Dessert");
    var lnBeverage = FindItem("Lunch", "Beverage");
    var lnOtherFood = FindItem("Lunch", "Other"); // NEW row

    // Lunch comment parsing
    var lnC = Model.LunchComment ?? "";
    bool lnPoor = lnC.Contains("poor appetite", StringComparison.OrdinalIgnoreCase);
    bool lnNausea = lnC.Contains("nausea", StringComparison.OrdinalIgnoreCase);
    bool lnRefused = lnC.Contains("patient refused meal", StringComparison.OrdinalIgnoreCase);
    bool lnInterrupted = lnC.Contains("interrupted meal time", StringComparison.OrdinalIgnoreCase);
    string? lnOtherMealTxt = null;
    if (lnC.Contains("other meal", StringComparison.OrdinalIgnoreCase))
    {
        var idx = lnC.IndexOf("other meal", StringComparison.OrdinalIgnoreCase);
        var seg = lnC.Substring(idx);
        var parts = seg.Split(';');
        var piece = parts[0];
        var colon = piece.IndexOf(':');
        if (colon > -1) lnOtherMealTxt = piece.Substring(colon + 1).Trim();
    }

    // Dinner comment parsing
    var dnC = Model.DinnerComment ?? "";
    bool dnPoor = dnC.Contains("poor appetite", StringComparison.OrdinalIgnoreCase);
    bool dnNausea = dnC.Contains("nausea", StringComparison.OrdinalIgnoreCase);
    bool dnRefused = dnC.Contains("patient refused meal", StringComparison.OrdinalIgnoreCase);
    bool dnInterrupted = dnC.Contains("interrupted meal time", StringComparison.OrdinalIgnoreCase);
    string? dnOtherMealTxt = null;
    if (dnC.Contains("other meal", StringComparison.OrdinalIgnoreCase))
    {
        var idx = dnC.IndexOf("other meal", StringComparison.OrdinalIgnoreCase);
        var seg = dnC.Substring(idx);
        var parts = seg.Split(';');
        var piece = parts[0];
        var colon = piece.IndexOf(':');
        if (colon > -1) dnOtherMealTxt = piece.Substring(colon + 1).Trim();
    }


    // --------------------
    // Afternoon tea items
    // --------------------
    var atFood = FindItem("Afternoon tea", "Food");
    var atBeverage = FindItem("Afternoon tea", "Beverage");
    // (Afternoon tea comment currently not persisted server-side; field will be empty in View)

    // --------------------
    // Dinner items
    // --------------------
    var dnSoup = FindItem("Dinner", "Soup");
    var dnBread = FindItem("Dinner", "Bread / Bread rolls");
    var dnMain = FindItem("Dinner", "Main meal");
    var dnCarb = FindItem("Dinner", "Potato/rice/pasta");
    var dnSalad = FindItem("Dinner", "Salad/vegetables");
    var dnSandwich = FindItem("Dinner", "Sandwiches");
    var dnDessert = FindItem("Dinner", "Dessert");
    var dnBeverage = FindItem("Dinner", "Beverage");
    var dnOtherFood = FindItem("Dinner", "Other"); // NEW row

    // --------------------
    // Supper items
    // --------------------
    var spFood = FindItem("Supper", "Food");
    var spBeverage = FindItem("Supper", "Beverage");
    // (Supper comment currently not persisted server-side; field will be empty in View)
}

<div class="container-fluid p-3" id="foodViewRoot">
    <!-- Title -->
    <div class="text-center text-white py-2 mb-4" style="background-color:#000000; border-radius:6px;">
        <h4 class="mb-0">Food Intake Record – View</h4>
    </div>

    <!-- Context -->
    <input type="hidden" id="foodLabId" value="@ViewBag.LabId" />
    <input type="hidden" id="foodPatientId" value="@ViewBag.PatientId" />
    <input type="hidden" id="foodHeaderId" value="@Model.Id" />

    <!-- All inputs are view-only -->
    <fieldset disabled>
        <!-- Day / Date / Shift Signatures -->
        <div class="card shadow-sm mb-4">
            <div class="card-body">
                <!-- Row 1: Day | Date -->
                <div class="row g-3">
                    <div class="col-md-6">
                        <label class="form-label">Day</label>
                        <input type="text" class="form-control" value="@Model.DayText" />
                    </div>
                    <div class="col-md-6">
                        <label class="form-label">Date</label>
                        <input type="date" class="form-control" value="@Model.IntakeDate.ToString("yyyy-MM-dd")" />
                    </div>
                </div>

                <!-- Row 2: Shift 1 -->
                <div class="row g-3 mt-1">
                    <div class="col-md-6">
                        <label class="form-label"> Nurse Signature (1)  </label>
                        <input type="text" class="form-control" value="@Model.Shift1Signature" />
                    </div>
                    <div class="col-md-6">
                        <label class="form-label"> Nurse Designation (1)</label>
                        <input type="text" class="form-control" value="@Model.Shift1Designation" />
                    </div>
                </div>

                <!-- Row 3: Shift 2 -->
                <div class="row g-3 mt-1">
                    <div class="col-md-6">
                        <label class="form-label"> Nurse Signature (2)</label>
                        <input type="text" class="form-control" value="@Model.Shift2Signature" />
                    </div>
                    <div class="col-md-6">
                        <label class="form-label"> Nurse Designation (2)</label>
                        <input type="text" class="form-control" value="@Model.Shift2Designation" />
                    </div>
                </div>
            </div>
        </div>

        <!-- Table -->
        <div class="table-responsive mb-4">
            <table class="table table-bordered align-middle fi-table">
                <thead class="table-light">
                    <tr>
                        <th class="text-center align-middle" style="width:140px;">MEAL</th>
                        <th class="align-middle">
                            <div class="text-center">FOOD</div>
                            <small class="text-muted d-block text-center">
                                Please record all food and drink on patient tray. Include high-protein drinks, tea, coffee.
                            </small>
                        </th>
                        <th class="text-center align-middle" style="width:180px;">AMOUNT CONSUMED</th>
                        <th class="text-center align-middle" style="width:280px;">
                            COMMENTS
                            <small class="d-block">Reason for reduced intake</small>
                        </th>
                    </tr>
                </thead>

                <tbody>
                    <!-- Breakfast (7 rows now, with "Other" food) -->
                    <tr>
                        <td rowspan="7" class="fw-bold text-center align-middle">
                            Breakfast<br /><small class="text-muted">meal size</small>
                        </td>
                        <td>
                            <label class="form-label mb-1">Cereal with milk</label>
                            <input type="text" class="form-control form-control-sm" value="@bfCereal?.Notes" />
                        </td>
                        <td>
                            <select class="form-select form-select-sm">
                                <option value="0" @(AmtVal(bfCereal?.Amount) == "0" ? "selected" : "")>0</option>
                                <option value="¼" @(AmtVal(bfCereal?.Amount) == "¼" ? "selected" : "")>¼</option>
                                <option value="½" @(AmtVal(bfCereal?.Amount) == "½" ? "selected" : "")>½</option>
                                <option value="¾" @(AmtVal(bfCereal?.Amount) == "¾" ? "selected" : "")>¾</option>
                                <option value="all" @(AmtVal(bfCereal?.Amount) == "all" ? "selected" : "")>all</option>
                            </select>
                        </td>

                        <!-- Breakfast comments (NO generic 'other' now) -->
                        <td rowspan="7" class="fi-comments">
                            <div class="fi-comments-fill">
                                <div class="form-check">
                                    <input class="form-check-input" type="checkbox" @(cPoor ? "checked" : "") />
                                    <label class="form-check-label">poor appetite</label>
                                </div>
                                <div class="form-check">
                                    <input class="form-check-input" type="checkbox" @(cNausea ? "checked" : "") />
                                    <label class="form-check-label">nausea</label>
                                </div>
                                <div class="form-check">
                                    <input class="form-check-input" type="checkbox" @(cRefused ? "checked" : "") />
                                    <label class="form-check-label">patient refused meal</label>
                                </div>
                                <div class="form-check">
                                    <input class="form-check-input" type="checkbox" @(cInterrupted ? "checked" : "") />
                                    <label class="form-check-label">interrupted meal time</label>
                                </div>

                                <div class="fi-pair">
                                    <div class="form-check mb-0 me-2 d-flex align-items-center">
                                        <input class="form-check-input" type="checkbox" @(string.IsNullOrWhiteSpace(otherMealTxt) ? "" : "checked") />
                                        <label class="form-check-label ms-2">other meal provided</label>
                                    </div>
                                    <input type="text" class="form-control form-control-sm" value="@otherMealTxt" />
                                </div>
                                <!-- generic "other + add a note" removed by design -->
                            </div>
                        </td>
                    </tr>
                    <tr>
                        <td>
                            <label class="form-label mb-1">Toast</label>
                            <input type="text" class="form-control form-control-sm" value="@bfToast?.Notes" />
                        </td>
                        <td>
                            <select class="form-select form-select-sm">
                                <option value="0" @(AmtVal(bfToast?.Amount) == "0" ? "selected" : "")>0</option>
                                <option value="¼" @(AmtVal(bfToast?.Amount) == "¼" ? "selected" : "")>¼</option>
                                <option value="½" @(AmtVal(bfToast?.Amount) == "½" ? "selected" : "")>½</option>
                                <option value="¾" @(AmtVal(bfToast?.Amount) == "¾" ? "selected" : "")>¾</option>
                                <option value="all" @(AmtVal(bfToast?.Amount) == "all" ? "selected" : "")>all</option>
                            </select>
                        </td>
                    </tr>
                    <tr>
                        <td>
                            <label class="form-label mb-1">Hot breakfast</label>
                            <input type="text" class="form-control form-control-sm" value="@bfHot?.Notes" />
                        </td>
                        <td>
                            <select class="form-select form-select-sm">
                                <option value="0" @(AmtVal(bfHot?.Amount) == "0" ? "selected" : "")>0</option>
                                <option value="¼" @(AmtVal(bfHot?.Amount) == "¼" ? "selected" : "")>¼</option>
                                <option value="½" @(AmtVal(bfHot?.Amount) == "½" ? "selected" : "")>½</option>
                                <option value="¾" @(AmtVal(bfHot?.Amount) == "¾" ? "selected" : "")>¾</option>
                                <option value="all" @(AmtVal(bfHot?.Amount) == "all" ? "selected" : "")>all</option>
                            </select>
                        </td>
                    </tr>
                    <tr>
                        <td>
                            <label class="form-label mb-1">Yoghurt</label>
                            <input type="text" class="form-control form-control-sm" value="@bfYoghurt?.Notes" />
                        </td>
                        <td>
                            <select class="form-select form-select-sm">
                                <option value="0" @(AmtVal(bfYoghurt?.Amount) == "0" ? "selected" : "")>0</option>
                                <option value="¼" @(AmtVal(bfYoghurt?.Amount) == "¼" ? "selected" : "")>¼</option>
                                <option value="½" @(AmtVal(bfYoghurt?.Amount) == "½" ? "selected" : "")>½</option>
                                <option value="¾" @(AmtVal(bfYoghurt?.Amount) == "¾" ? "selected" : "")>¾</option>
                                <option value="all" @(AmtVal(bfYoghurt?.Amount) == "all" ? "selected" : "")>all</option>
                            </select>
                        </td>
                    </tr>
                    <tr>
                        <td>
                            <label class="form-label mb-1">Fruit</label>
                            <input type="text" class="form-control form-control-sm" value="@bfFruit?.Notes" />
                        </td>
                        <td>
                            <select class="form-select form-select-sm">
                                <option value="0" @(AmtVal(bfFruit?.Amount) == "0" ? "selected" : "")>0</option>
                                <option value="¼" @(AmtVal(bfFruit?.Amount) == "¼" ? "selected" : "")>¼</option>
                                <option value="½" @(AmtVal(bfFruit?.Amount) == "½" ? "selected" : "")>½</option>
                                <option value="¾" @(AmtVal(bfFruit?.Amount) == "¾" ? "selected" : "")>¾</option>
                                <option value="all" @(AmtVal(bfFruit?.Amount) == "all" ? "selected" : "")>all</option>
                            </select>
                        </td>
                    </tr>
                    <tr>
                        <td>
                            <label class="form-label mb-1">Beverage</label>
                            <input type="text" class="form-control form-control-sm" value="@bfBeverage?.Notes" />
                        </td>
                        <td>
                            <select class="form-select form-select-sm">
                                <option value="0" @(AmtVal(bfBeverage?.Amount) == "0" ? "selected" : "")>0</option>
                                <option value="¼" @(AmtVal(bfBeverage?.Amount) == "¼" ? "selected" : "")>¼</option>
                                <option value="½" @(AmtVal(bfBeverage?.Amount) == "½" ? "selected" : "")>½</option>
                                <option value="¾" @(AmtVal(bfBeverage?.Amount) == "¾" ? "selected" : "")>¾</option>
                                <option value="all" @(AmtVal(bfBeverage?.Amount) == "all" ? "selected" : "")>all</option>
                            </select>
                        </td>
                    </tr>
                    <tr>
                        <td>
                            <label class="form-label mb-1">Other</label>
                            <input type="text" class="form-control form-control-sm" value="@bfOtherFood?.Notes" />
                        </td>
                        <td>
                            <select class="form-select form-select-sm">
                                <option value="0" @(AmtVal(bfOtherFood?.Amount) == "0" ? "selected" : "")>0</option>
                                <option value="¼" @(AmtVal(bfOtherFood?.Amount) == "¼" ? "selected" : "")>¼</option>
                                <option value="½" @(AmtVal(bfOtherFood?.Amount) == "½" ? "selected" : "")>½</option>
                                <option value="¾" @(AmtVal(bfOtherFood?.Amount) == "¾" ? "selected" : "")>¾</option>
                                <option value="all" @(AmtVal(bfOtherFood?.Amount) == "all" ? "selected" : "")>all</option>
                            </select>
                        </td>
                    </tr>

                    <!-- Morning Tea -->
                    <tr class="fi-section-sep">
                        <td rowspan="2" class="fw-bold text-center align-middle">Morning tea</td>
                        <td>
                            <label class="form-label mb-1">Food</label>
                            <input type="text" class="form-control form-control-sm" value="@mtFood?.Notes" />
                        </td>
                        <td>
                            <select class="form-select form-select-sm">
                                <option value="0" @(AmtVal(mtFood?.Amount) == "0" ? "selected" : "")>0</option>
                                <option value="¼" @(AmtVal(mtFood?.Amount) == "¼" ? "selected" : "")>¼</option>
                                <option value="½" @(AmtVal(mtFood?.Amount) == "½" ? "selected" : "")>½</option>
                                <option value="¾" @(AmtVal(mtFood?.Amount) == "¾" ? "selected" : "")>¾</option>
                                <option value="all" @(AmtVal(mtFood?.Amount) == "all" ? "selected" : "")>all</option>
                            </select>
                        </td>
                        <td class="fi-comments fi-comments--center" rowspan="2">
                            <div class="fi-centerbox">
                                <input type="text" class="form-control form-control-sm" value="@Model.MorningTeaComment" />
                            </div>
                        </td>
                    </tr>
                    <tr>
                        <td>
                            <label class="form-label mb-1">Beverage</label>
                            <input type="text" class="form-control form-control-sm" value="@mtBeverage?.Notes" />
                        </td>
                        <td>
                            <select class="form-select form-select-sm">
                                <option value="0" @(AmtVal(mtBeverage?.Amount) == "0" ? "selected" : "")>0</option>
                                <option value="¼" @(AmtVal(mtBeverage?.Amount) == "¼" ? "selected" : "")>¼</option>
                                <option value="½" @(AmtVal(mtBeverage?.Amount) == "½" ? "selected" : "")>½</option>
                                <option value="¾" @(AmtVal(mtBeverage?.Amount) == "¾" ? "selected" : "")>¾</option>
                                <option value="all" @(AmtVal(mtBeverage?.Amount) == "all" ? "selected" : "")>all</option>
                            </select>
                        </td>
                    </tr>

                    <!-- Lunch (9 rows, with "Other" food, comments without generic 'other') -->
                    <tr class="fi-section-sep">
                        <td rowspan="9" class="fw-bold text-center align-middle">Lunch</td>
                        <td>
                            <label class="form-label mb-1">Soup</label>
                            <input type="text" class="form-control form-control-sm" value="@lnSoup?.Notes" />
                        </td>
                        <td>
                            <select class="form-select form-select-sm">
                                <option value="0" @(AmtVal(lnSoup?.Amount) == "0" ? "selected" : "")>0</option>
                                <option value="¼" @(AmtVal(lnSoup?.Amount) == "¼" ? "selected" : "")>¼</option>
                                <option value="½" @(AmtVal(lnSoup?.Amount) == "½" ? "selected" : "")>½</option>
                                <option value="¾" @(AmtVal(lnSoup?.Amount) == "¾" ? "selected" : "")>¾</option>
                                <option value="all" @(AmtVal(lnSoup?.Amount) == "all" ? "selected" : "")>all</option>
                            </select>
                        </td>
                        <td rowspan="9" class="fi-comments">
                            <div class="fi-comments-fill">
                                <div class="form-check"><input class="form-check-input" type="checkbox" @(lnPoor ? "checked" : "") /><label class="form-check-label">poor appetite</label></div>
                                <div class="form-check"><input class="form-check-input" type="checkbox" @(lnNausea ? "checked" : "") /><label class="form-check-label">nausea</label></div>
                                <div class="form-check"><input class="form-check-input" type="checkbox" @(lnRefused ? "checked" : "") /><label class="form-check-label">patient refused meal</label></div>
                                <div class="form-check"><input class="form-check-input" type="checkbox" @(lnInterrupted ? "checked" : "") /><label class="form-check-label">interrupted meal time</label></div>
                                <div class="fi-pair">
                                    <div class="form-check d-flex align-items-center mb-0">
                                        <input class="form-check-input" type="checkbox" @(string.IsNullOrWhiteSpace(lnOtherMealTxt) ? "" : "checked") />
                                        <label class="form-check-label ms-2">other meal provided</label>
                                    </div>
                                    <input type="text" class="form-control form-control-sm" value="@lnOtherMealTxt" />
                                </div>
                            </div>
                        </td>

                    </tr>
                    <tr>
                        <td><label class="form-label mb-1">Bread / Bread rolls</label><input type="text" class="form-control form-control-sm" value="@lnBread?.Notes" /></td>
                        <td>
                            <select class="form-select form-select-sm">
                                <option value="0" @(AmtVal(lnBread?.Amount) == "0" ? "selected" : "")>0</option>
                                <option value="¼" @(AmtVal(lnBread?.Amount) == "¼" ? "selected" : "")>¼</option>
                                <option value="½" @(AmtVal(lnBread?.Amount) == "½" ? "selected" : "")>½</option>
                                <option value="¾" @(AmtVal(lnBread?.Amount) == "¾" ? "selected" : "")>¾</option>
                                <option value="all" @(AmtVal(lnBread?.Amount) == "all" ? "selected" : "")>all</option>
                            </select>
                        </td>
                    </tr>
                    <tr>
                        <td><label class="form-label mb-1">Main meal</label><input type="text" class="form-control form-control-sm" value="@lnMain?.Notes" /></td>
                        <td>
                            <select class="form-select form-select-sm">
                                <option value="0" @(AmtVal(lnMain?.Amount) == "0" ? "selected" : "")>0</option>
                                <option value="¼" @(AmtVal(lnMain?.Amount) == "¼" ? "selected" : "")>¼</option>
                                <option value="½" @(AmtVal(lnMain?.Amount) == "½" ? "selected" : "")>½</option>
                                <option value="¾" @(AmtVal(lnMain?.Amount) == "¾" ? "selected" : "")>¾</option>
                                <option value="all" @(AmtVal(lnMain?.Amount) == "all" ? "selected" : "")>all</option>
                            </select>
                        </td>
                    </tr>
                    <tr>
                        <td><label class="form-label mb-1">Potato/rice/pasta</label><input type="text" class="form-control form-control-sm" value="@lnCarb?.Notes" /></td>
                        <td>
                            <select class="form-select form-select-sm">
                                <option value="0" @(AmtVal(lnCarb?.Amount) == "0" ? "selected" : "")>0</option>
                                <option value="¼" @(AmtVal(lnCarb?.Amount) == "¼" ? "selected" : "")>¼</option>
                                <option value="½" @(AmtVal(lnCarb?.Amount) == "½" ? "selected" : "")>½</option>
                                <option value="¾" @(AmtVal(lnCarb?.Amount) == "¾" ? "selected" : "")>¾</option>
                                <option value="all" @(AmtVal(lnCarb?.Amount) == "all" ? "selected" : "")>all</option>
                            </select>
                        </td>
                    </tr>
                    <tr>
                        <td><label class="form-label mb-1">Salad/vegetables</label><input type="text" class="form-control form-control-sm" value="@lnSalad?.Notes" /></td>
                        <td>
                            <select class="form-select form-select-sm">
                                <option value="0" @(AmtVal(lnSalad?.Amount) == "0" ? "selected" : "")>0</option>
                                <option value="¼" @(AmtVal(lnSalad?.Amount) == "¼" ? "selected" : "")>¼</option>
                                <option value="½" @(AmtVal(lnSalad?.Amount) == "½" ? "selected" : "")>½</option>
                                <option value="¾" @(AmtVal(lnSalad?.Amount) == "¾" ? "selected" : "")>¾</option>
                                <option value="all" @(AmtVal(lnSalad?.Amount) == "all" ? "selected" : "")>all</option>
                            </select>
                        </td>
                    </tr>
                    <tr>
                        <td><label class="form-label mb-1">Sandwiches</label><input type="text" class="form-control form-control-sm" value="@lnSandwich?.Notes" /></td>
                        <td>
                            <select class="form-select form-select-sm">
                                <option value="0" @(AmtVal(lnSandwich?.Amount) == "0" ? "selected" : "")>0</option>
                                <option value="¼" @(AmtVal(lnSandwich?.Amount) == "¼" ? "selected" : "")>¼</option>
                                <option value="½" @(AmtVal(lnSandwich?.Amount) == "½" ? "selected" : "")>½</option>
                                <option value="¾" @(AmtVal(lnSandwich?.Amount) == "¾" ? "selected" : "")>¾</option>
                                <option value="all" @(AmtVal(lnSandwich?.Amount) == "all" ? "selected" : "")>all</option>
                            </select>
                        </td>
                    </tr>
                    <tr>
                        <td><label class="form-label mb-1">Dessert</label><input type="text" class="form-control form-control-sm" value="@lnDessert?.Notes" /></td>
                        <td>
                            <select class="form-select form-select-sm">
                                <option value="0" @(AmtVal(lnDessert?.Amount) == "0" ? "selected" : "")>0</option>
                                <option value="¼" @(AmtVal(lnDessert?.Amount) == "¼" ? "selected" : "")>¼</option>
                                <option value="½" @(AmtVal(lnDessert?.Amount) == "½" ? "selected" : "")>½</option>
                                <option value="¾" @(AmtVal(lnDessert?.Amount) == "¾" ? "selected" : "")>¾</option>
                                <option value="all" @(AmtVal(lnDessert?.Amount) == "all" ? "selected" : "")>all</option>
                            </select>
                        </td>
                    </tr>
                    <tr>
                        <td><label class="form-label mb-1">Beverage</label><input type="text" class="form-control form-control-sm" value="@lnBeverage?.Notes" /></td>
                        <td>
                            <select class="form-select form-select-sm">
                                <option value="0" @(AmtVal(lnBeverage?.Amount) == "0" ? "selected" : "")>0</option>
                                <option value="¼" @(AmtVal(lnBeverage?.Amount) == "¼" ? "selected" : "")>¼</option>
                                <option value="½" @(AmtVal(lnBeverage?.Amount) == "½" ? "selected" : "")>½</option>
                                <option value="¾" @(AmtVal(lnBeverage?.Amount) == "¾" ? "selected" : "")>¾</option>
                                <option value="all" @(AmtVal(lnBeverage?.Amount) == "all" ? "selected" : "")>all</option>
                            </select>
                        </td>
                    </tr>
                    <tr>
                        <td><label class="form-label mb-1">Other</label><input type="text" class="form-control form-control-sm" value="@lnOtherFood?.Notes" /></td>
                        <td>
                            <select class="form-select form-select-sm">
                                <option value="0" @(AmtVal(lnOtherFood?.Amount) == "0" ? "selected" : "")>0</option>
                                <option value="¼" @(AmtVal(lnOtherFood?.Amount) == "¼" ? "selected" : "")>¼</option>
                                <option value="½" @(AmtVal(lnOtherFood?.Amount) == "½" ? "selected" : "")>½</option>
                                <option value="¾" @(AmtVal(lnOtherFood?.Amount) == "¾" ? "selected" : "")>¾</option>
                                <option value="all" @(AmtVal(lnOtherFood?.Amount) == "all" ? "selected" : "")>all</option>
                            </select>
                        </td>
                    </tr>

                    <!-- Afternoon tea -->
                    <tr class="fi-section-sep">
                        <td rowspan="2" class="fw-bold text-center align-middle">Afternoon tea</td>
                        <td>
                            <label class="form-label mb-1">Food</label>
                            <input type="text" class="form-control form-control-sm" value="@atFood?.Notes" />
                        </td>
                        <td>
                            <select class="form-select form-select-sm">
                                <option value="0" @(AmtVal(atFood?.Amount) == "0" ? "selected" : "")>0</option>
                                <option value="¼" @(AmtVal(atFood?.Amount) == "¼" ? "selected" : "")>¼</option>
                                <option value="½" @(AmtVal(atFood?.Amount) == "½" ? "selected" : "")>½</option>
                                <option value="¾" @(AmtVal(atFood?.Amount) == "¾" ? "selected" : "")>¾</option>
                                <option value="all" @(AmtVal(atFood?.Amount) == "all" ? "selected" : "")>all</option>
                            </select>
                        </td>
                        <td class="fi-comments fi-comments--center" rowspan="2">
                            <div class="fi-centerbox">
                                <input type="text" class="form-control form-control-sm" value="@Model.AfternoonTeaComment" />

                            </div>
                        </td>
                    </tr>
                    <tr>
                        <td>
                            <label class="form-label mb-1">Beverage</label>
                            <input type="text" class="form-control form-control-sm" value="@atBeverage?.Notes" />
                        </td>
                        <td>
                            <select class="form-select form-select-sm">
                                <option value="0" @(AmtVal(atBeverage?.Amount) == "0" ? "selected" : "")>0</option>
                                <option value="¼" @(AmtVal(atBeverage?.Amount) == "¼" ? "selected" : "")>¼</option>
                                <option value="½" @(AmtVal(atBeverage?.Amount) == "½" ? "selected" : "")>½</option>
                                <option value="¾" @(AmtVal(atBeverage?.Amount) == "¾" ? "selected" : "")>¾</option>
                                <option value="all" @(AmtVal(atBeverage?.Amount) == "all" ? "selected" : "")>all</option>
                            </select>
                        </td>
                    </tr>

                    <!-- Dinner (9 rows, with "Other" food, comments without generic 'other') -->
                    <tr class="fi-section-sep">
                        <td rowspan="9" class="fw-bold text-center align-middle">Dinner</td>
                        <td>
                            <label class="form-label mb-1">Soup</label>
                            <input type="text" class="form-control form-control-sm" value="@dnSoup?.Notes" />
                        </td>
                        <td>
                            <select class="form-select form-select-sm">
                                <option value="0" @(AmtVal(dnSoup?.Amount) == "0" ? "selected" : "")>0</option>
                                <option value="¼" @(AmtVal(dnSoup?.Amount) == "¼" ? "selected" : "")>¼</option>
                                <option value="½" @(AmtVal(dnSoup?.Amount) == "½" ? "selected" : "")>½</option>
                                <option value="¾" @(AmtVal(dnSoup?.Amount) == "¾" ? "selected" : "")>¾</option>
                                <option value="all" @(AmtVal(dnSoup?.Amount) == "all" ? "selected" : "")>all</option>
                            </select>
                        </td>
                        <td rowspan="9" class="fi-comments">
                            <div class="fi-comments-fill">
                                <div class="form-check"><input class="form-check-input" type="checkbox" @(dnPoor ? "checked" : "") /><label class="form-check-label">poor appetite</label></div>
                                <div class="form-check"><input class="form-check-input" type="checkbox" @(dnNausea ? "checked" : "") /><label class="form-check-label">nausea</label></div>
                                <div class="form-check"><input class="form-check-input" type="checkbox" @(dnRefused ? "checked" : "") /><label class="form-check-label">patient refused meal</label></div>
                                <div class="form-check"><input class="form-check-input" type="checkbox" @(dnInterrupted ? "checked" : "") /><label class="form-check-label">interrupted meal time</label></div>
                                <div class="fi-pair">
                                    <div class="form-check d-flex align-items-center mb-0">
                                        <input class="form-check-input" type="checkbox" @(string.IsNullOrWhiteSpace(dnOtherMealTxt) ? "" : "checked") />
                                        <label class="form-check-label ms-2">other meal provided</label>
                                    </div>
                                    <input type="text" class="form-control form-control-sm" value="@dnOtherMealTxt" />
                                </div>
                            </div>
                        </td>

                    </tr>
                    <tr>
                        <td><label class="form-label mb-1">Bread / Bread rolls</label><input type="text" class="form-control form-control-sm" value="@dnBread?.Notes" /></td>
                        <td>
                            <select class="form-select form-select-sm">
                                <option value="0" @(AmtVal(dnBread?.Amount) == "0" ? "selected" : "")>0</option>
                                <option value="¼" @(AmtVal(dnBread?.Amount) == "¼" ? "selected" : "")>¼</option>
                                <option value="½" @(AmtVal(dnBread?.Amount) == "½" ? "selected" : "")>½</option>
                                <option value="¾" @(AmtVal(dnBread?.Amount) == "¾" ? "selected" : "")>¾</option>
                                <option value="all" @(AmtVal(dnBread?.Amount) == "all" ? "selected" : "")>all</option>
                            </select>
                        </td>
                    </tr>
                    <tr>
                        <td><label class="form-label mb-1">Main meal</label><input type="text" class="form-control form-control-sm" value="@dnMain?.Notes" /></td>
                        <td>
                            <select class="form-select form-select-sm">
                                <option value="0" @(AmtVal(dnMain?.Amount) == "0" ? "selected" : "")>0</option>
                                <option value="¼" @(AmtVal(dnMain?.Amount) == "¼" ? "selected" : "")>¼</option>
                                <option value="½" @(AmtVal(dnMain?.Amount) == "½" ? "selected" : "")>½</option>
                                <option value="¾" @(AmtVal(dnMain?.Amount) == "¾" ? "selected" : "")>¾</option>
                                <option value="all" @(AmtVal(dnMain?.Amount) == "all" ? "selected" : "")>all</option>
                            </select>
                        </td>
                    </tr>
                    <tr>
                        <td><label class="form-label mb-1">Potato/rice/pasta</label><input type="text" class="form-control form-control-sm" value="@dnCarb?.Notes" /></td>
                        <td>
                            <select class="form-select form-select-sm">
                                <option value="0" @(AmtVal(dnCarb?.Amount) == "0" ? "selected" : "")>0</option>
                                <option value="¼" @(AmtVal(dnCarb?.Amount) == "¼" ? "selected" : "")>¼</option>
                                <option value="½" @(AmtVal(dnCarb?.Amount) == "½" ? "selected" : "")>½</option>
                                <option value="¾" @(AmtVal(dnCarb?.Amount) == "¾" ? "selected" : "")>¾</option>
                                <option value="all" @(AmtVal(dnCarb?.Amount) == "all" ? "selected" : "")>all</option>
                            </select>
                        </td>
                    </tr>
                    <tr>
                        <td><label class="form-label mb-1">Salad/vegetables</label><input type="text" class="form-control form-control-sm" value="@dnSalad?.Notes" /></td>
                        <td>
                            <select class="form-select form-select-sm">
                                <option value="0" @(AmtVal(dnSalad?.Amount) == "0" ? "selected" : "")>0</option>
                                <option value="¼" @(AmtVal(dnSalad?.Amount) == "¼" ? "selected" : "")>¼</option>
                                <option value="½" @(AmtVal(dnSalad?.Amount) == "½" ? "selected" : "")>½</option>
                                <option value="¾" @(AmtVal(dnSalad?.Amount) == "¾" ? "selected" : "")>¾</option>
                                <option value="all" @(AmtVal(dnSalad?.Amount) == "all" ? "selected" : "")>all</option>
                            </select>
                        </td>
                    </tr>
                    <tr>
                        <td><label class="form-label mb-1">Sandwiches</label><input type="text" class="form-control form-control-sm" value="@dnSandwich?.Notes" /></td>
                        <td>
                            <select class="form-select form-select-sm">
                                <option value="0" @(AmtVal(dnSandwich?.Amount) == "0" ? "selected" : "")>0</option>
                                <option value="¼" @(AmtVal(dnSandwich?.Amount) == "¼" ? "selected" : "")>¼</option>
                                <option value="½" @(AmtVal(dnSandwich?.Amount) == "½" ? "selected" : "")>½</option>
                                <option value="¾" @(AmtVal(dnSandwich?.Amount) == "¾" ? "selected" : "")>¾</option>
                                <option value="all" @(AmtVal(dnSandwich?.Amount) == "all" ? "selected" : "")>all</option>
                            </select>
                        </td>
                    </tr>
                    <tr>
                        <td><label class="form-label mb-1">Dessert</label><input type="text" class="form-control form-control-sm" value="@dnDessert?.Notes" /></td>
                        <td>
                            <select class="form-select form-select-sm">
                                <option value="0" @(AmtVal(dnDessert?.Amount) == "0" ? "selected" : "")>0</option>
                                <option value="¼" @(AmtVal(dnDessert?.Amount) == "¼" ? "selected" : "")>¼</option>
                                <option value="½" @(AmtVal(dnDessert?.Amount) == "½" ? "selected" : "")>½</option>
                                <option value="¾" @(AmtVal(dnDessert?.Amount) == "¾" ? "selected" : "")>¾</option>
                                <option value="all" @(AmtVal(dnDessert?.Amount) == "all" ? "selected" : "")>all</option>
                            </select>
                        </td>
                    </tr>
                    <tr>
                        <td><label class="form-label mb-1">Beverage</label><input type="text" class="form-control form-control-sm" value="@dnBeverage?.Notes" /></td>
                        <td>
                            <select class="form-select form-select-sm">
                                <option value="0" @(AmtVal(dnBeverage?.Amount) == "0" ? "selected" : "")>0</option>
                                <option value="¼" @(AmtVal(dnBeverage?.Amount) == "¼" ? "selected" : "")>¼</option>
                                <option value="½" @(AmtVal(dnBeverage?.Amount) == "½" ? "selected" : "")>½</option>
                                <option value="¾" @(AmtVal(dnBeverage?.Amount) == "¾" ? "selected" : "")>¾</option>
                                <option value="all" @(AmtVal(dnBeverage?.Amount) == "all" ? "selected" : "")>all</option>
                            </select>
                        </td>
                    </tr>
                    <tr>
                        <td><label class="form-label mb-1">Other</label><input type="text" class="form-control form-control-sm" value="@dnOtherFood?.Notes" /></td>
                        <td>
                            <select class="form-select form-select-sm">
                                <option value="0" @(AmtVal(dnOtherFood?.Amount) == "0" ? "selected" : "")>0</option>
                                <option value="¼" @(AmtVal(dnOtherFood?.Amount) == "¼" ? "selected" : "")>¼</option>
                                <option value="½" @(AmtVal(dnOtherFood?.Amount) == "½" ? "selected" : "")>½</option>
                                <option value="¾" @(AmtVal(dnOtherFood?.Amount) == "¾" ? "selected" : "")>¾</option>
                                <option value="all" @(AmtVal(dnOtherFood?.Amount) == "all" ? "selected" : "")>all</option>
                            </select>
                        </td>
                    </tr>

                    <!-- Supper -->
                    <tr class="fi-section-sep">
                        <td rowspan="2" class="fw-bold text-center align-middle">Supper</td>
                        <td>
                            <label class="form-label mb-1">Food</label>
                            <input type="text" class="form-control form-control-sm" value="@spFood?.Notes" />
                        </td>
                        <td>
                            <select class="form-select form-select-sm">
                                <option value="0" @(AmtVal(spFood?.Amount) == "0" ? "selected" : "")>0</option>
                                <option value="¼" @(AmtVal(spFood?.Amount) == "¼" ? "selected" : "")>¼</option>
                                <option value="½" @(AmtVal(spFood?.Amount) == "½" ? "selected" : "")>½</option>
                                <option value="¾" @(AmtVal(spFood?.Amount) == "¾" ? "selected" : "")>¾</option>
                                <option value="all" @(AmtVal(spFood?.Amount) == "all" ? "selected" : "")>all</option>
                            </select>
                        </td>
                        <td class="fi-comments fi-comments--center" rowspan="2">
                            <div class="fi-centerbox">
                                <input type="text" class="form-control form-control-sm" value="@Model.SupperComment" />

                            </div>
                        </td>
                    </tr>
                    <tr>
                        <td>
                            <label class="form-label mb-1">Beverage</label>
                            <input type="text" class="form-control form-control-sm" value="@spBeverage?.Notes" />
                        </td>
                        <td>
                            <select class="form-select form-select-sm">
                                <option value="0" @(AmtVal(spBeverage?.Amount) == "0" ? "selected" : "")>0</option>
                                <option value="¼" @(AmtVal(spBeverage?.Amount) == "¼" ? "selected" : "")>¼</option>
                                <option value="½" @(AmtVal(spBeverage?.Amount) == "½" ? "selected" : "")>½</option>
                                <option value="¾" @(AmtVal(spBeverage?.Amount) == "¾" ? "selected" : "")>¾</option>
                                <option value="all" @(AmtVal(spBeverage?.Amount) == "all" ? "selected" : "")>all</option>
                            </select>
                        </td>
                    </tr>
                </tbody>
            </table>
        </div>
    </fieldset>

    <!-- Actions (enabled) -->
    <div class="row">
        <div class="col-sm-9">
            <a href="javascript:void(0);" id="btnBackToFoodList" class="btn btn-secondary">Back to List</a>
            <a href="javascript:void(0);" id="btnEditFood" class="btn btn-primary" style="background-color:#FF8A30;">Edit</a>
        </div>
    </div>
</div>

<script>
    // Back → reload list
    $("#btnBackToFoodList").on("click", function () {
        $.get("/Patient/GetFoodIntakeList",
            {
                labId: $("#foodLabId").val(),
                patientId: $("#foodPatientId").val()
            },
            function (html) { $("#content-area").html(html); });
    });

    // Edit → open edit view
    $("#btnEditFood").on("click", function () {
        $.get("/Patient/GetFoodIntakeEdit",
            { labId: $("#foodLabId").val(), id: $("#foodHeaderId").val() },
            function (html) { $("#content-area").html(html); });
    });
</script>
